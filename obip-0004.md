<pre>
  OBIP: 4
  Title: Posts
  Author: <a href="https://keybase.io/@drwasho">Dr Washington Y. Sanchez</a>
  Status: Accepted
  Type: Standards Track
  Created: 2017-08-27
</pre>

## Abstract

- This OBIP describes the addition of a new type of content that can be published and shared on the network by users: `posts`
- Posts enable a user to publish written content that can be viewed by other users visiting their store or via third party search
- Posts can be used for market-related activities such as: advertising listings, announce store updates, publish a new coupon for a special offer etc
- Moreover, posts can also be used for non-market activities and serve as a platform for censorship-resistant expression on the network, encouraging non-vendors to regularly use the network

## Motivation

OpenBazaar has limited tools for Vendors to engage with potential customers. *Engagement* can be in the form of advertising a listing, announcing a store update, brand-building, announcing special offers or coupons for a sale to name a few. Users in general can also benefit from these tools by blogging interesting items they have seen on the network, and driving sales for Vendors (i.e. OB influencers).

Aside from side-channels (i.e. off the OpenBazaar network), Vendors can only communicate to potential buyers via the About section of their profile, or via direct message. The About section is limited in form and function, and its history is not traversable. Direct message is excellent for one-on-one communication, but it can only be initiated by a user visiting the store.

What is required is a means for Vendors to publish a blog-style post that users can view when visiting their store.

## Requirements

Posts allow a Vendor to upload a message or image in a dedicate space in their store. Posts have traversable history, designed for one-way communication from the Vendor to users. The purpose of posts is to inform visitors of any content they feel necessary to drive sales and/or engage with users (i.e. announcements, brand building, promotions, coupons etc).

### User Stories

#### Role: Publisher

*A 'publisher' is a vendor or user that is publishing a post on their node for other users to consume.*

1. As a Publisher, I can post a message {text, image} that is displayed in my store.
2. As a Publisher, I can edit a message that is displayed in my store.
3. As a Publisher, I can delete a message this is displayed in my store.
4. As a Publisher, I can fetch the previous posts in my store.

#### Role: User

1. As a user, I can read a post {text and/or image} created by a Publisher.
2. As a user, I can fetch previous posts {text and/or image} created by a Publisher.

## Specification

There are 3 types of posts:re

1. **Post.** A generic, standalone social post.
2. **Comment.** A comment against another post, listing, or store.
3. **Repost.** The equivalent of a 'retweet', only for any type of content on the OpenBazaar network.

A post should allow the publisher to include:

1. **`status`.** This is a short content space where a user can post the equivalent of a 'tweet'. The maximum character limit is 280.
2. **`longForm`.** This is a longer content space than `status` ideal of Medium-style blog posts. The maximum character limit is 50,000.
3. **`images`.** A post can carry up to 30 images reference by their IPFS hashes.
4. **`channels`.** Similar to IRC, posts can be targeted for up to 30 channels. Posts can be curated based on whether posts are relevant and included in a feed for that channel.
5. **`tags`.** Each post can carry up to 50 tags, which allow for more granular discovery of a post in their store, or in a channel.
6. **`reference`.** Required when making a comment or repost, which points to the target content. While originally designed for other posts, any other valid content address on the network can be used (i.e. listing, store, image etc).

All posts need to be digitally signed to establish authenticity, and will include a slug for IPNS resolution so the publisher can edit their post.

### Protobuf

The protobuf spec:

```
message Post {
    string slug                         = 1;
    ID vendorID                         = 2;
    string status                       = 3;
    string longForm                     = 4;
    repeated Image images               = 5;
    repeated string tags                = 6;
    repeated string channels            = 7;
    PostType postType                   = 8;
    string reference                    = 9;
    google.protobuf.Timestamp timestamp = 10;

    message Image {
        string filename = 1;
        string original = 2;
        string large    = 3;
        string medium   = 4;
        string small    = 5;
        string tiny     = 6;
    }

    enum PostType {
        POST        = 0;
        COMMENT     = 1;
        REPOST      = 2;
    }
}

message SignedPost {
    Post post           = 1;
    string hash         = 2;
    bytes signature     = 3;
}
```

### API

We propose that OpenBazaar server-node implementations support the following endpoints:

1. GET `/ob/posts`
2. GET `/ob/post`
3. POST `/ob/post`
4. PUT `/ob/post`
5. DELETE `/ob/post`

#### GET `ob/posts`

Returns an array of posts from the user or a peer (i.e. `/ob/posts/:peerId`):

```JSON
[
  {
    "channels": [
      "test"
    ],
    "hash": "zb2rhhXuXraeA2KVJwXmfiSVrhLh8sCQsbgzSXMPhubnnebDn",
    "images": [
      {
          "medium": "zb2rhaFhqziCWk1zo5tMRxQEUchfvJFaGG4DY1anEoR4GnYrN",
          "small": "zb2rhbDCeEiTTunugWPaRRKFCfNKUaB7aCR53nrPnMa9usZXY",
          "tiny": "zb2rhgqJDbshwAgPjs7X2h4mDm3V3BpLbp4tFGqkg1LNkg9yV"
      }
    ],
    "postType": "POST",
    "reference": "",
    "slug": "testy7",
    "status": "testy7",
    "tags": [
      "Yo"
    ],
    "timestamp": "2018-10-11T12:17:09.434846957Z"
  }
]
```

#### GET `ob/post`

Returns an individual post from the user or a peer (i.e. `/ob/post/:peerId/:slug_or_hash`):

```JSON
{
  "post": {
    "slug": "testy5",
    "vendorID": {
      "peerID": "QmS7QyLXGgxge2Nap3wnZr1pBdxDSJ4xu1dGVKnL4XW9YQ",
      "handle": "",
      "pubkeys": {
        "identity": "CAESINypt5aYTJ8ssxKNDusANNH9HFqKsDOC3VJT4sYhPato",
        "bitcoin": "A5EJy0XaW/S+OHn2xebf8Nb6kv54H6+lsOBlOpWXb/46"
      },
      "bitcoinSig": "MEQCIH0h0NZmJE5gWgo5soUdkggnNYSBvykWvm2DbhjW+CgHAiB309+MUBtnAkyFaaI3lEVzFUjwZRm/RU7pGFt1NT4+cA=="
    },
    "status": "testy5",
    "longForm": "This is a test post dawg.",
    "images": [
      {
        "filename": "cat",
        "original": "zb2rhe2o6WbHqcER5VUKsMUbQrmpCC6ihg8qZ4JS9wVgKz9wm",
        "large": "zb2rhmBUB9i7UkfmeD3obJYK3FFS5K8N8QHaUanG8UWLVBHiY",
        "medium": "zb2rhaFhqziCWk1zo5tMRxQEUchfvJFaGG4DY1anEoR4GnYrN",
        "small": "zb2rhbDCeEiTTunugWPaRRKFCfNKUaB7aCR53nrPnMa9usZXY",
        "tiny": "zb2rhgqJDbshwAgPjs7X2h4mDm3V3BpLbp4tFGqkg1LNkg9yV"
      }
    ],
    "tags": [
      "Yo"
    ],
    "channels": [
      "test"
    ],
    "postType": "REPOST",
    "reference": "zb2rhbnwaLFrTfw8uGzZKPfS16SLt14FmEFNghrGRZUhY3g2Y",
    "timestamp": "2018-10-11T12:08:38.639363790Z"
  },
  "hash": "zb2rheDrgxGWWfiJBnFCAp7xwmK2Yt1AistCBzaYCrFB1adpN",
  "signature": "NVg62CekPbI+3j6YvaTokSi0H8Z5cbMgTW84yT+P5U6E1mYg/0vdF3c6OggW9BcSd9bhQR6wfgaWgurxmi3OBQ=="
}
```

#### POST `/ob/post`

Creates a new post:

```JSON
{
	"status": "testy7",
	"longForm": "This is a test post dawg.",
	"postType": "POST",
	"reference": "",
	"images": [
		{
			"filename": "cat",
			"large": "zb2rhmBUB9i7UkfmeD3obJYK3FFS5K8N8QHaUanG8UWLVBHiY",
			"medium": "zb2rhaFhqziCWk1zo5tMRxQEUchfvJFaGG4DY1anEoR4GnYrN",
			"original": "zb2rhe2o6WbHqcER5VUKsMUbQrmpCC6ihg8qZ4JS9wVgKz9wm",
			"small": "zb2rhbDCeEiTTunugWPaRRKFCfNKUaB7aCR53nrPnMa9usZXY",
			"tiny": "zb2rhgqJDbshwAgPjs7X2h4mDm3V3BpLbp4tFGqkg1LNkg9yV"
		}
	],
	"tags": [
		"Yo"
	],
	"channels": [
		"test"
	]
}
```

#### PUT `/ob/post`

Edits an existing post:

```JSON
{
	"status": "testy7",
	"longForm": "This is a test post son.",
	"postType": "POST",
	"reference": "",
	"images": [
		{
			"filename": "cat",
			"large": "zb2rhmBUB9i7UkfmeD3obJYK3FFS5K8N8QHaUanG8UWLVBHiY",
			"medium": "zb2rhaFhqziCWk1zo5tMRxQEUchfvJFaGG4DY1anEoR4GnYrN",
			"original": "zb2rhe2o6WbHqcER5VUKsMUbQrmpCC6ihg8qZ4JS9wVgKz9wm",
			"small": "zb2rhbDCeEiTTunugWPaRRKFCfNKUaB7aCR53nrPnMa9usZXY",
			"tiny": "zb2rhgqJDbshwAgPjs7X2h4mDm3V3BpLbp4tFGqkg1LNkg9yV"
		}
	],
	"tags": [
		"Yo"
	],
	"channels": [
		"test"
	]
}
```

#### DELETE `/ob/post`

Deletes an existing post: `/ob/posts/:slug_or_hash`

## Rationale

_Advantages_

1. Allows for users to engage with visitors and promote sales
2. Creates basic tools for an influencer and affiliate program
3. It is a platform for censorship-resistant expression

_Disadvantages_

- `index.json` file can get bloated if there are a lot of posts
    - This could potentially be mitigated by only storing hashes of the post in an array

## Backwards Compatibility

This OBIP extends the protocol and creates a collection of new APIs, as well as a new directory to store posts. This means that non-upgraded nodes will not be able to fulfil API calls for posts if requested. The server will return a standard error for unrecognised API calls.

Posts do not alter the existing database or API calls, so disruption to clients should be minimal. As a result, clients can choose to support this feature - if at all - at their leisure. 

## Future work

There are two primary areas of work that need improvments:

1. Feed
2. Reactions

### Feed

The 'feed' is simply a list of posts based on the nodes you follow, or posts published to a certain channel or with a tag. The feed will not require a user to fetch a list of posts manually from each node that they follow. Currently, third parties can construct a social feed of posts based on a list of `peerIds`, a channel, or tag. We aim to explore technologies such as IPFS pubsub and [OrbitDB](https://github.com/orbitdb/orbit-db) in further detail to remove this requirement and allow a more decentralized construction of feeds.

### Reactions

'Reactions' are social reactions: like, love, smile etc. While this data could exist as its own type of post, this solution isn't scalable and would require frequent republishing of the root IPNS directory, and undermining the ability of peers to seed the latest version of the store. A decentralised solution is required to handle rapidly dynamic data; again, OrbitDB seems like a good candidate to investigate.
